---
title: 博客搭建记录
date: 2023-03-29 12:58:10
categories:
- [DevLog]
tags:
- docker
- Hexo
- GithubPages
- 搭建博客
---

因为之前有搭建过，所以这次搭建过程中并没有遇到莫名其妙的意外情况，不需要花时间去深入了解和解决问题。

其实，现在的网络技术环境，从某些方面来说，也快变成“消费”市场了，比如搭建一个个人博客，先挑选一个博客框架，选好主题，然后在本地用各种 node 衍生工具初始化配置、输入内容，就可加工成美味的菜肴，轻奢点的消费者，还可以在 GitHub 上建立对应的仓库，配置 Actions，在个人的云主机上实现自动化上线部署。

在这个过程中，不再需要花费什么力气，只需要知道有什么，用什么就行，甚至不知道有什么，别人也会通过各种途径手把手教。从有想法，到把它变现，简直是太容易了。

以下是建设本站的过程，是结合个人的使用环境和习惯，后期所做的记录，仅供借鉴，不作参考指导。



# 技术栈

| 材料                           | 说明                                                         |
| ------------------------------ | ------------------------------------------------------------ |
| Hexo[^1] & hexo-theme-Chic[^2] | Hexo 框架 和 hexo-theme-Chic 主题，足够的轻量简约风          |
| docker + node                  | docker 容器管理和 node 的最新发行版镜像                        |
| Typora[^3] 或普通文本编辑工具  | 参数配置和页面编写                                           |
| Github + git                   | 代码仓库管理和 GitHubPages 代理部署网站，git 为本地版本控制软件 |



# 建设过程

大部分操作过程是在 Linux 系统上完成的。



### 初始化

- 执行过程

```shell
# 进入容器环境
docker run -it --rm -u 1000:1000 --net=host -v $(pwd):/prjs node /bin/bash
# 临时安装 Hexo 工具，并初始化对应的目录结构
cd /tmp
npm i hexo-cli
node_modules/hexo-cli/bin/hexo init /prjs/blog
# 固化 Hexo 工具到项目的开发环境中
cd /prjs/blog
yarn add hexo
# 下载并切换主题
git clone https://github.com/Siricee/hexo-theme-Chic.git themes/Chic
# $
# 使用配置编辑工具修改 blog 工程目录下的 _config.yml 配置，使其中 
# "theme: landscape"  改为  "theme: Chic"
# 
# 添加相应的界面，使符合主题基本页面要求
node_modules/hexo/bin/hexo new page tag
node_modules/hexo/bin/hexo new page category
node_modules/hexo/bin/hexo new page about
# $
# 参考主题的使用说明，使用配置文本编辑工具分别打开 
# blog/source/tag/index.md  和  blog/source/category/index.md
# 并添加 "layout: xxx"项，修改成其对应的布局
#
# 预览效果，在浏览器中基本能看到最初效果了
node_modules/hexo/bin/hexo server
# 退出容器环境，或者再打开一个终端进入到相应的目录上
exit
cd blog
# 使主题目录和主题变成普通文件目录
rm themes/.gitkeep 2>null
rm -rf themes/Chic/.git
# 生成版本管理的初始化状态
git init
git add .
git commit -m "xxxx"
```



- 说明

1. 进入 docker 中进行主要的部署，是因为电脑配置较差，而平时使用的工具比较杂，如果每使用一种工具都要在本地安装有对应的环境，电脑的磁盘空间很快就承受不住了，系统环境也变得过于碎片与杂乱，而使用容器，需要的时候随时可以拉取，不要的时候，删掉就可以，不会留下任何痕迹。另外，也不用在意不同工具的不同版本间依赖关系，它几乎总是能满足需求的。

   > docker run -it --rm -u 1000:1000 --net=host -v $(pwd):/prjs node /bin/bash
   >
   > | 参数            | 说明                                                         |
   > | --------------- | ------------------------------------------------------------ |
   > | run             | 创建并启动一个容器                                           |
   > | -it             | 使用有交互的终端接口，就像一个 shell 一样可以交互            |
   > | -\-rm            | 退出时删掉容器，节省空间                                     |
   > | -u 1000:1000    | 以指定 uid:gid 的身份操作控制台，使创建的文件在容器外部有权访问 |
   > | -\-net=host      | 指定容器网络类型，预览的时候，可以通过容器外访问             |
   > | -v $(pwd):/prjs | 映射容器外的当前目录到容器内 /prjs 上                        |
   > | node /bin/bash  | 使用 node 镜像，在启动后打开一个 bash                        |

2. 容器一关闭，里面的非映射目录所有的修改都将被清空，为免于每次进容器都要安装，所以 hexo 的工具这里选着了作为项目的开发工具，被写入依赖中。第一次装载临时目录，是因为没有全局安装的权限（以1000:1000 的身份进入容器的）。

3. Hexo 工具初始化后，目录被处理过的，是一个普通目录，而主题是一个独立的项目。因为确定需要在主题目录中做非预期的修改，同时不希望与项目源头进行各种低效率的沟通或同时维护本地两个项目，故移除了主题项目的版本信息，把整个项目从根目录作为一个工程进行维护，仅在项目初始化版本的 commit 注释中做了说明。

4. 上面的过程确实把一个问题做得复杂了，而且有些模式固定的指令也相对有点长（尽管它们可以被 alias 修饰），前面也说了，这是个人习惯。在高效率的当下，完成这个过程，确实还可以很整洁的，但我还是希望在非工作状态中，可以更有仪式感一些。这类“复杂”的过程，就像早上路遇的陌生人，你带着微笑跟他说了句早上好。



### 定制修改

- 执行过程[^4]

1. 修改框架配置 `_config.yml`

   包括网站的标题、说明、关键字、最终发布地址等基本属性

2. 修改主题的配置参数 `themes/Chic/_config.yml`

   包括个人的属性参数、页面的元素

3. 修改一些主题中的实现细节，使尽量达到符合自己要求的最佳效果，主要包括一下

   1. 文字翻译
   2. 链接跳转地址修正

4. 编写`关于`页面`source/about/index.md`，完成网站内容的初步建设



- 说明

1. 不是很熟悉配置项的可以参考对应的官方说明和示例
2. 并不是每个主题都需要修改，也不是每个主题都值得信赖，毕竟这些主题大部分都是个人开发者自行维护，难免有什么疏漏的地方，还是得按实际效果和是否达到自己预期为准
3. 在本项目环境中，默认的页面主要有三种：
   - 分类：文章按不同分类聚合，不需要维护，在编写文章的时候指定所属分类即可
   - 标签：文章按不同标签聚合，不需要维护，在编写文章的时候指定所属标签即可，与分类类似但在内部逻辑中，分类是树形关系，标签是线性（但该主题中对分类并没有实现树形关系效果）
   - 文章：需要用户自行维护的博客内容



### 部署上线

- 预期

本地采用 git 进行管理，GitHub 作为远程仓库，在 GitHubPages 进行发布，使用GitHub 的 Actions 进行自动编译部署。

所以后期使用过程中，只要在本地完成新文章的编写后，再利用 git 工具 commit 并 push 到远程仓库即可，新的内容将在稍后自动更新到博客网站。

因为使用的都是开源的东西，输出的只是内容而已，而内容本就在页面中展示，个人觉得没有什么敏感的东西，所以博客的编译前后工程都直接放在了同一个公开的仓库中，仅使用两个不同分支而已。

- 执行过程

0. 申请 GitHub 的 `Access Token`[^5]，这不是一个必须的过程，如果已经申请过了（所有项目可共用），则直接使用即可。

1. 在 GitHub 上新建公开仓库，新建页面中仅输入仓库名、描述和公开属性即可，因为仓库是从本地上传的，不需要初始化仓库

2. 在新仓库的 `Settings/Secrets` 中创建自动部署时用到的关键参数（`Access Token`），如取名为`Token`

3. 确保本地项目的“规范”完整，如包含`README.md`、 `LICENSE`等相关声明，信息内容为待发布状态（没有正在编辑中的内容）

4. 创建自动部署脚本[^6]，可参考 Hexo 官方的教程，创建对应的路径文件，修改其中一之相关的参数（如`Token`）

5. 最后再整理工程，在本地 commit 分支归档当前状态

6. 把本地仓库提交到远程仓库

   ```shell
   git remote add origin git@github.com:nuyuiq/blog
   git push -u origin master
   ```

   刚提交完成，可以在 web 端该仓库的 Actions 分页中，可以看到有任务正在执行，过会将可以在预期的线上地址上看到博客的最终效果



- 说明

1. 涉及的东西比较多，如果没接触过或不了解相应过程的话，可能有些不知所然，它们都是一个个小功能小模块，当真正组合在一起的时候，就能发挥出别样的魅力，以后需要输出新内容，只需要在本地 `WACP`(write/add/commit/push)即可
2. 对应的密钥申请、仓库创建等过程，随着官网的更新迭代，可能略有不同。该发布过程几乎全部依托第三方，此后是否有变更、技术是否不适用，目前也无法确定
3. 一个规规矩矩的墙内人，在 GitHub 上进行操作是，可能会遇到延迟卡顿，甚至请求超时等想象，部署其上的博客同样如此。在 GitHub 上进行网站部署是一个比较江湖气派的做法，有条件的话个人不建议



# 总结

这算是本站的开山之作了，前前后后也整过至少两次博客，但都因懒于维护最后下线了，而内容也过于表现，生活工作上的事亦导致没觉得有什么可以输出的。同样这次也没有给予厚望，有些事情想做了就去做而已。

而且从这几次的建设过程中可以感受得到，互联网发展的迅猛，高效率是真真正正落实到了各个方面，以往的繁琐操作、昂贵的成本，现在都变得唾手可得。我不知道这对一个行业来说意味则什么，但从职业命途来说，还是感触挺深的。

回归建设，这个过程，或者这个行为模板，对于建设网站来说，没遇到什么棘手的问题，很顺利。不知道为什么，这样反而好像少了一点什么乐趣似的，好奇怪哈。



[^1]: Hexo: https://hexo.io/zh-cn/
[^2]: hexo-theme-Chic: https://github.com/Siricee/hexo-theme-Chic
[^3]: Typora: https://typoraio.cn/
[^4]: 参考基本修改差异: https://github.com/nuyuiq/blog/commit/3625effbd3ec28df6c479aace9c09d1fe5dc92ed
[^5]: 官方申请指南: https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token
[^6]: 部署Hexo: https://hexo.io/zh-cn/docs/github-pages
